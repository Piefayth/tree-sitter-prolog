steps:
  test:
    when:
      - event: push
        branch: main
      - event: pull_request
        branch: main
    image: codeberg.org/foxy/tree-sitter:latest
    commands:
      - pnpm i --no-frozen-lockfile
      - tree-sitter init-config
      - tree-sitter generate
      - tree-sitter test && tree-sitter parse examples/*.pl --quiet --time
  diff:
    when:
      - event: push
        branch: main
      - event: pull_request
        branch: main
    image: bitnami/git
    commands:
      - |
        if [ "$(git status --porcelain)" ]; then
          git status --porcelain
          exit 1
        fi
